@model Sales_Management.Models.Employee
@{
    ViewData["Title"] = "Chi tiết nhân viên";
}

<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-4">
    <div>
        <h3 class="fw-bold text-dark">Hồ sơ nhân viên</h3>
        <p class="text-muted mb-0">Xem chi tiết thông tin và lịch sử làm việc</p>
    </div>
    <div class="d-flex gap-2">
        <a asp-action="Edit" asp-route-id="@Model.EmployeeId" class="btn btn-primary rounded-pill px-4">
            <i class="bi bi-pencil me-2"></i> Chỉnh sửa
        </a>
        <a asp-action="Index" class="btn btn-outline-secondary rounded-pill px-4">
            <i class="bi bi-arrow-left me-2"></i> Quay lại
        </a>
    </div>
</div>

<div class="row g-4">
    <!-- Profile Sidebar -->
    <div class="col-lg-4">
         <div class="card-modern text-center h-100 position-relative overflow-hidden">
            <div class="bg-gradient-primary position-absolute top-0 start-0 w-100" style="height: 100px; background: linear-gradient(135deg, #4361ee, #7367f0);"></div>
            <div class="position-relative pt-5">
                 <div class="d-inline-flex align-items-center justify-content-center rounded-circle bg-white border border-4 border-white shadow mb-3" style="width: 120px; height: 120px;">
                    <span class="fs-1 fw-bold text-primary">@Model.User?.FullName?.Substring(0,1).ToUpper()</span>
                </div>
                <h4 class="fw-bold mb-1">@Model.User?.FullName</h4>
                <p class="text-muted mb-3">@Model.Position</p>
            </div>
            
            <div class="row text-center border-top border-bottom py-3 my-3">
                <div class="col-6 border-end">
                    <h5 class="fw-bold mb-0">@Model.TimeAttendances.Count()</h5>
                    <small class="text-muted text-uppercase">Ngày làm</small>
                </div>
                <div class="col-6">
                    <h5 class="fw-bold mb-0">@(Model.BasicSalary.HasValue ? (Model.BasicSalary.Value / 1000000).ToString("0.#") + "M" : "-")</h5>
                    <small class="text-muted text-uppercase">Lương</small>
                </div>
            </div>

            <div class="text-start px-3">
                <div class="d-flex align-items-center mb-3">
                    <div class="bg-light rounded-circle p-2 me-3 text-primary"><i class="bi bi-envelope"></i></div>
                    <div>
                        <small class="text-muted d-block">Email</small>
                        <span class="text-dark fw-bold">@Model.User?.Email</span>
                    </div>
                </div>
                <div class="d-flex align-items-center mb-3">
                    <div class="bg-light rounded-circle p-2 me-3 text-success"><i class="bi bi-telephone"></i></div>
                    <div>
                        <small class="text-muted d-block">Điện thoại</small>
                        <span class="text-dark fw-bold">@(Model.User?.PhoneNumber ?? "Chưa cập nhật")</span>
                    </div>
                </div>
                <div class="d-flex align-items-center mb-3">
                    <div class="bg-light rounded-circle p-2 me-3 text-info"><i class="bi bi-building"></i></div>
                    <div>
                        <small class="text-muted d-block">Phòng ban</small>
                        <span class="text-dark fw-bold">@Model.Department</span>
                    </div>
                </div>
                 <div class="d-flex align-items-center">
                    <div class="bg-light rounded-circle p-2 me-3 text-warning"><i class="bi bi-calendar-check"></i></div>
                    <div>
                        <small class="text-muted d-block">Ngày bắt đầu</small>
                        <span class="text-dark fw-bold">@Model.StartWorkingDate?.ToString("dd/MM/yyyy")</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Attendance History -->
    <div class="col-lg-8">
        <div class="card-modern h-100">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h5 class="mb-0 text-dark fw-bold">Lịch sử điểm danh</h5>
                <button class="btn btn-sm btn-light rounded-pill border"><i class="bi bi-download me-1"></i> Xuất báo cáo</button>
            </div>
            
             @if (Model.TimeAttendances != null && Model.TimeAttendances.Any())
            {
                <div class="table-responsive">
                    <table class="table-modern">
                        <thead>
                            <tr>
                                <th>Ngày</th>
                                <th class="text-center">Vào</th>
                                <th class="text-center">Ra</th>
                                <th class="text-center">Số giờ</th>
                                <th class="text-center">Trạng thái</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var attn in Model.TimeAttendances.OrderByDescending(t => t.Date).Take(10))
                            {
                                <tr>
                                    <td>
                                        <div class="fw-bold">@attn.Date.ToString("dd/MM/yyyy")</div>
                                        <small class="text-muted">@attn.Date.DayOfWeek</small>
                                    </td>
                                    <td class="text-center font-monospace">@(attn.CheckInTime.HasValue ? attn.CheckInTime.Value.ToString("HH:mm") : "--:--")</td>
                                    <td class="text-center font-monospace">@(attn.CheckOutTime.HasValue ? attn.CheckOutTime.Value.ToString("HH:mm") : "--:--")</td>
                                     <td class="text-center">
                                        @if(attn.CheckInTime.HasValue && attn.CheckOutTime.HasValue)
                                        {
                                            var duration = attn.CheckOutTime.Value - attn.CheckInTime.Value;
                                            <span class="fw-bold text-dark">@duration.ToString(@"hh\:mm")</span>
                                        }
                                        else
                                        {
                                            <span class="text-muted">-</span>
                                        }
                                    </td>
                                    <td class="text-center">
                                        @if (!attn.CheckInTime.HasValue) { <span class="badge-modern badge-danger-modern">Vắng mặt</span> }
                                        else if (!attn.CheckOutTime.HasValue) { <span class="badge-modern badge-warning-modern">Đang làm việc</span> }
                                        else { <span class="badge-modern badge-success-modern">Hoàn thành</span> }
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                 <div class="text-center py-5">
                    <div class="mb-3 text-light-secondary opacity-50"><i class="bi bi-clock-history fs-1"></i></div>
                    <p class="text-muted">Chưa có dữ liệu điểm danh nào.</p>
                </div>
            }
        </div>
    </div>
</div>
