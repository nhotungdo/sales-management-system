@model Sales_Management.Models.Wallet
@{
    ViewData["Title"] = "Ví của tôi";
}

<div class="container py-4">
    <!-- Balance Card -->
    <div class="row justify-content-center mb-5">
        <div class="col-md-8 col-lg-6">
            <div class="card bg-primary text-white shadow-lg border-0 rounded-4 overflow-hidden position-relative" style="background: linear-gradient(135deg, #0d6efd 0%, #0099ff 100%);">
                <div class="position-absolute top-0 start-0 w-100 h-100" style="background: radial-gradient(circle at 10% 20%, rgba(255,255,255,0.1) 0%, transparent 20%); z-index: 0;"></div>
                <div class="card-body p-5 text-center position-relative" style="z-index: 1;">
                    <h5 class="card-title text-white-50 text-uppercase ls-1 fw-bold">Số dư hiện tại</h5>
                    <div class="display-3 fw-bold my-4 text-white">
                        <i class="bi bi-coin text-warning me-2"></i>@Model.Balance?.ToString("N0")
                    </div>
                    
                    <button class="btn btn-light btn-lg rounded-pill px-5 mt-2 fw-bold text-primary shadow-sm" type="button" data-bs-toggle="collapse" data-bs-target="#topUpForm" aria-expanded="false" aria-controls="topUpForm">
                        <i class="bi bi-plus-circle-fill me-2"></i>Nạp xu ngay
                    </button>
                    
                    <div id="topUpForm" class="collapse mt-4">
                        <div class="card border-0 p-4 text-dark shadow-sm rounded-3">
                            <form asp-action="CreateTopUp" method="post">
                                <h6 class="fw-bold mb-3 text-start">Nạp thêm xu vào ví:</h6>
                                <div class="input-group mb-3 drop-shadow">
                                    <input type="number" name="coinAmount" class="form-control form-control-lg" min="1" required placeholder="Nhập số xu (VD: 100)">
                                    <span class="input-group-text bg-light fw-bold text-muted">XU</span>
                                </div>
                                <div class="d-grid">
                                    <button type="submit" class="btn btn-primary btn-lg fw-bold">
                                        Tiếp tục thanh toán <i class="bi bi-arrow-right ms-2"></i>
                                    </button>
                                </div>
                                <div class="mt-3 text-muted small bg-light p-2 rounded">
                                    <i class="bi bi-info-circle-fill me-1"></i> Tỷ lệ quy đổi: <strong>1 xu = 1000 VNĐ </strong>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- History -->
    <div class="card shadow border-0 rounded-4">
        <div class="card-header bg-white py-3 border-0 d-flex justify-content-between align-items-center ps-4 pe-4">
            <h4 class="mb-0 fw-bold text-primary"><i class="bi bi-clock-history me-2"></i>Lịch sử giao dịch</h4>
            <button class="btn btn-outline-secondary btn-sm rounded-pill"><i class="bi bi-filter me-1"></i> Lọc</button>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="bg-light text-uppercase text-muted small fw-bold">
                        <tr>
                            <th class="ps-4 py-3">Mã GD</th>
                            <th class="py-3">Thời gian</th>
                            <th class="py-3">Loại</th>
                            <th class="py-3 text-end">Số lượng</th>
                            <th class="py-3 text-center">Trạng thái</th>
                            <th class="py-3">Nội dung</th>
                            <th class="py-3"></th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model.WalletTransactions != null && Model.WalletTransactions.Any())
                        {
                            foreach (var item in Model.WalletTransactions)
                            {
                                <tr>
                                    <td class="ps-4 text-nowrap font-monospace text-muted">@item.TransactionCode</td>
                                    <td class="text-nowrap text-secondary">@item.CreatedDate?.ToString("dd/MM/yyyy HH:mm")</td>
                                    <td>
                                        @if(item.TransactionType == "Deposit" || item.TransactionType == "TopUp") {
                                            <span class="badge bg-primary bg-opacity-10 text-primary rounded-pill px-3 py-2 border border-primary-subtle">
                                                <i class="bi bi-arrow-down-circle me-1"></i> Nạp xu
                                            </span>
                                        } else {
                                            <span class="badge bg-secondary bg-opacity-10 text-secondary rounded-pill px-3 py-2 border border-secondary-subtle">
                                                <i class="bi bi-gear me-1"></i> @item.TransactionType
                                            </span>
                                        }
                                    </td>
                                    <td class="fw-bold fs-5 text-end font-monospace">
                                        @if(item.Amount > 0)
                                        {
                                            <span class="text-success">+@item.Amount.ToString("N0")</span>
                                        }
                                        else
                                        {
                                            <span class="text-danger">@item.Amount.ToString("N0")</span>
                                        }
                                    </td>
                                    <td class="text-center">
                                        @if(item.Status == "Success")
                                        {
                                            <span class="badge bg-success rounded-pill"><i class="bi bi-check-circle me-1"></i> Hoàn thành</span>
                                        }
                                        else if(item.Status == "Pending")
                                        {
                                            <span class="badge bg-warning text-dark rounded-pill mb-1"><i class="bi bi-hourglass-split me-1"></i> Đang chờ</span>
                                        }
                                        else if(item.Status == "Cancelled")
                                        {
                                            <span class="badge bg-secondary rounded-pill"><i class="bi bi-x-circle me-1"></i> Đã hủy</span>
                                        }
                                    </td>
                                    <td class="text-muted small text-truncate" style="max-width: 200px;" title="@item.Description">@item.Description</td>
                                    <td class="text-end pe-4">
                                         @if(item.Status == "Pending")
                                        {
                                            <a asp-action="Payment" asp-route-id="@item.TransactionId" class="btn btn-sm btn-primary rounded-pill px-3">
                                                Thanh toán
                                            </a>
                                        }
                                    </td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="7" class="text-center py-5 text-muted">
                                    <div class="py-4">
                                        <i class="bi bi-inbox fs-1 d-block mb-3 opacity-25"></i>
                                        Chưa có giao dịch nào
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
            
            <!-- Pagination (Placeholder) -->
            <div class="card-footer bg-white border-top-0 py-3 d-flex justify-content-end">
                 <!-- Implement pagination if needed -->
            </div>
        </div>
    </div>
</div>
